<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KAUST Vision Captioning System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <!-- FIX: serve CSS from root (FastAPI provides /style.css even if /static is absent) -->
    <link href="/style.css" rel="stylesheet" />
</head>
<body>
    <!-- Background Pattern -->
    <div class="background-pattern"></div>

    <!-- Header with Logos -->
    <header class="glass-header">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-3">
                    <div class="logo-container">
                        <!-- These images are optional; if you have /static/images mounted, theyâ€™ll load -->
                        <img src="/static/images/KAUST_Logo.png" alt="KAUST University" class="kaust-logo" />
                    </div>
                </div>
                <div class="col-6 text-center">
                    <h1 class="main-title">Vision Captioning System</h1>
                    <p class="subtitle"><h3>Real-time Video-to-Text Summarization Using Object Detection-Guided Frame Selection and Multi-modal Language Models</h3></p>
                </div>
                <div class="col-3 text-end">
                    <div class="logo-container">
                        <img src="/static/images/KAUST_Academy_Logo.png" alt="KAUST Academy" class="kaust-academy-logo" />
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container my-5">
        <!-- Mode Selection -->
        <div class="glass-card mb-4">
            <div class="card-body">
                <div class="row">
                    <div class="col-12">
                        <div class="mode-selector" role="tablist">
                            <button class="mode-btn active" data-mode="upload" role="tab">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <span>Upload Image</span>
                            </button>
                            <button class="mode-btn" data-mode="camera" role="tab">
                                <i class="fas fa-video"></i>
                                <span>Live Camera</span>
                            </button>
                            <button class="mode-btn" data-mode="video" role="tab">
                                <i class="fas fa-film"></i>
                                <span>Video Analysis</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div class="row">
            <!-- Main Processing Area -->
            <div class="col-lg-8">
                <!-- Upload Mode -->
                <div class="mode-content active" id="upload-mode">
                    <div class="glass-card">
                        <div class="card-body">
                            <div class="upload-zone" id="upload-zone">
                                <i class="fas fa-cloud-upload-alt upload-icon"></i>
                                <h4>Drop your image here</h4>
                                <p>or click to browse</p>
                                <input type="file" id="file-input" accept="image/*" hidden />
                            </div>
                            <div class="image-preview" id="image-preview" style="display: none;">
                                <img id="preview-img" alt="Preview" />
                                <div class="image-overlay">
                                    <!-- FIX: removed inline onclick; JS binds the handler -->
                                    <button class="btn btn-glass" id="reset-upload">
                                        <i class="fas fa-times"></i> Clear
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Camera Mode -->
                <div class="mode-content" id="camera-mode">
                    <div class="glass-card">
                        <div class="card-body">
                            <div class="camera-container">
                                <div class="camera-preview" id="camera-preview">
                                    <div class="camera-placeholder">
                                        <i class="fas fa-video camera-icon"></i>
                                        <h4>Camera Feed</h4>
                                        <button class="btn btn-glass" id="start-camera">
                                            <i class="fas fa-play"></i> Start Camera
                                        </button>
                                    </div>
                                    <img id="camera-feed" style="display: none;" alt="Camera Feed" />
                                </div>
                                <div class="camera-controls">
                                    <button class="btn btn-glass" id="stop-camera" style="display: none;">
                                        <i class="fas fa-stop"></i> Stop
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Video Mode -->
                <div class="mode-content" id="video-mode">
                    <div class="glass-card">
                        <div class="card-body">
                            <div class="upload-zone" id="video-upload-zone">
                                <i class="fas fa-film upload-icon"></i>
                                <h4>Drop your video here</h4>
                                <p>or click to browse</p>
                                <input type="file" id="video-input" accept="video/*" hidden />
                            </div>
                            <div class="video-processing" id="video-processing" style="display: none;">
                                <div class="progress mb-3">
                                    <div class="progress-bar glass-progress" role="progressbar" style="width: 0%"></div>
                                </div>
                                <p class="text-center">Processing video...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Panel -->
            <div class="col-lg-4">
                <div class="glass-card results-panel">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-brain"></i> Analysis Results
                        </h5>
                        <div id="results-content">
                            <div class="no-results">
                                <i class="fas fa-lightbulb"></i>
                                <p>Upload an image, start camera, or analyze video to see AI-generated captions and insights.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Status Panel -->
                <div class="glass-card mt-3">
                    <div class="card-body">
                        <h6 class="card-title">
                            <i class="fas fa-info-circle"></i> System Status
                        </h6>
                        <div class="status-indicator">
                            <div class="status-item">
                                <span class="status-dot online"></span>
                                <span>YOLO Detection: Ready</span>
                            </div>
                            <div class="status-item">
                                <span class="status-dot online"></span>
                                <span>BLIP Captioning: Ready</span>
                            </div>
                            <div class="status-item">
                                <span class="status-dot online"></span>
                                <span>Cohere LLM: Ready</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p id="loading-text">Processing...</p>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="toast" class="toast glass-toast" role="alert">
            <div class="toast-header">
                <i class="fas fa-info-circle me-2"></i>
                <strong class="me-auto">System</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- FIX: serve JS from root (FastAPI provides /app.js even if /static is absent) -->
    <script src="/app.js"></script>
</body>
</html>
